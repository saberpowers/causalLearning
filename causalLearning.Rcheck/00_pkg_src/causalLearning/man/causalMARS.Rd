% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/causalMARS.R
\name{causalMARS}
\alias{causalMARS}
\title{Fit a causal MARS model}
\usage{
causalMARS(x, tx, y, maxterms = 11, nquant = 5, degree = ncol(x),
  eps = 1, backstep = FALSE, x.val = NULL, tx.val = NULL,
  y.val = NULL, propensity = FALSE, stratum = rep(1, nrow(x)),
  stratum.val = NULL, minnum = 5)
}
\arguments{
\item{x}{matrix of covariates}

\item{tx}{vector of treatment indicators (0 or 1)}

\item{y}{vector of response values}

\item{maxterms}{maximum number of terms to include in the regression basis
(e.g. \code{maxterms = 11} means intercept + 5 pairs added)}

\item{nquant}{number of quantiles used in splitting}

\item{degree}{max number of different predictors that can interact in model}

\item{eps}{shrinkage factor for new term added}

\item{backstep}{logical: after building out regression basis, should
backward stepwise selection be used to create a sequence of models, with
the criterion evaluated on a validation set to choose among the sequence?}

\item{x.val}{optional matrix of validation-set covariates
(only used if \code{backstep = TRUE})}

\item{tx.val}{optional vector of validation-set treatment indicators
(only used if \code{backstep = TRUE})}

\item{y.val}{optional vector of validation-set response values
(only used if \code{backstep = TRUE})}

\item{propensity}{logical: should propensity score stratification be used?}

\item{stratum}{optional vector giving propensity score stratum for each
observation (only used if \code{propensity = TRUE})}

\item{stratum.val}{optional vector giving propensity score stratum for each
validation-set observation
(only used if \code{propensity = backstep = TRUE})}

\item{minnum}{minimum number of observations in each arm of each propensity
score stratum needed to estimate regression coefficients for basis
(only used if \code{propensity = TRUE})}
}
\value{
an object of class \code{causalMARS} with attributes:
 \itemize{
   \item parent: indices of nodes that are parents at each stage
   \item childvar: index of predictor chosen at each forward step
   \item childquant: quantile of cutoff chosen at each forward step
   \item quant: quantiles of the columns of x
   \item active: indices of columns with nonzero norm
   \item allvars: list of variables appearing in each term
   \item khat: the sequence of terms deleted at each step
   \item deltahat: relative change in rss
   \item rsstesthat: validation-set rss achieved by each model in sequence
   \item setesthat: standard error for rsstesthat
   \item tim1: time elapsed during forward stepwise phase
   \item tim2: total time elapsed
   \item x
   \item tx
   \item y
   \item maxterms
   \item eps
   \item backstep
   \item propensity
   \item x.val
   \item tx.val
   \item y.val
   \item stratum
   \item stratum.val
   \item minnum
 }
}
\description{
Fit a causal MARS model
}
\details{
parallel arms mars with backward stepwise BOTH randomized case and
 propensity stratum. data structures: model terms (nodes) are numbered
 1, 2, ... with 1 representing the intercept. forward stepwise:
 modmatrix contains basis functions as model is built up -- two columns are
 added at each step. Does not include a column of ones for tidiness,
 we always add two terms, even when term added in linear (so that reflected
 version is just zero).
 backward stepwise: khat is the sequence of terms deleted at each step,
 based on deltahat = relative change in rss. rsstesthat is rss over test
 (validation) set achieved by each reduced model in sequence- used later for
 selecting a member of the sequence. active2 contains indices of columns with
 nonzero norm
}
\examples{
# Randomized experiment example

n = 100 # number of training-set patients to simulate
p = 10  # number of features for each training-set patient

# Simulate data
x = matrix(rnorm(n * p), nrow = n, ncol = p) # simulate covariate matrix
tx_effect = x[, 1] + (x[, 2] > 0) # simple heterogeneous treatment effect
tx = rbinom(n, size = 1, p = 0.5) # random treatment assignment
y = rowMeans(x) + tx * tx_effect + rnorm(n, sd = 0.001) # simulate response

# Estimate causal MARS model
fit_cm = causalLearning::causalMARS(x, tx, y)
pred_cm = predict(fit_cm, newx = x)

# Visualize results
plot(tx_effect, pred_cm, main = 'Causal MARS',
 xlab = 'True treatment effect', ylab = 'Estimated treatment effect')
abline(0, 1, lty = 2)

}
